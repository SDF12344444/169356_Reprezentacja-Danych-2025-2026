ALTER USER msu_pyskloa IDENTIFIED BY adam1234;

CREATE TABLE REGIONS (
    region_id NUMBER PRIMARY KEY,
    region_name VARCHAR2(50) NOT NULL
);

CREATE TABLE COUNTRIES (
    country_id CHAR(2) PRIMARY KEY,
    country_name VARCHAR2(50),
    region_id NUMBER
);

ALTER TABLE COUNTRIES
ADD CONSTRAINT countries_region_fk
FOREIGN KEY (region_id)
REFERENCES REGIONS(region_id);

CREATE TABLE LOCATIONS (
    location_id NUMBER PRIMARY KEY,
    street_address VARCHAR2(100),
    postal_code VARCHAR2(20),
    city VARCHAR2(50) NOT NULL,
    state_province VARCHAR2(50),
    country_id CHAR(2)
);

ALTER TABLE LOCATIONS
ADD CONSTRAINT locations_country_fk
FOREIGN KEY (country_id)
REFERENCES COUNTRIES(country_id);

CREATE TABLE JOBS (
    job_id NUMBER PRIMARY KEY,
    job_title VARCHAR2(50) NOT NULL,
    min_salary NUMBER,
    max_salary NUMBER,
    CONSTRAINT jobs_salary_chk CHECK (max_salary - min_salary >= 2000)
);

CREATE TABLE EMPLOYEES (
    employee_id NUMBER PRIMARY KEY,
    first_name VARCHAR2(50),
    last_name VARCHAR2(50) NOT NULL,
    email VARCHAR2(100) UNIQUE,
    phone_number VARCHAR2(20),
    hire_date DATE NOT NULL,
    job_id NUMBER,
    salary NUMBER(10,2),
    commission_pct NUMBER(5,2),
    manager_id NUMBER,
    department_id NUMBER
);

CREATE TABLE DEPARTMENTS (
    department_id NUMBER PRIMARY KEY,
    department_name VARCHAR2(50) NOT NULL,
    manager_id NUMBER,
    location_id NUMBER
);

CREATE TABLE JOB_HISTORY (
    employee_id NUMBER,
    start_date DATE NOT NULL,
    end_date DATE NOT NULL,
    job_id NUMBER,
    department_id NUMBER,
    PRIMARY KEY (employee_id, start_date)
);

ALTER TABLE DEPARTMENTS
ADD CONSTRAINT dept_manager_fk
FOREIGN KEY (manager_id)
REFERENCES EMPLOYEES(employee_id);

ALTER TABLE DEPARTMENTS
ADD CONSTRAINT dept_location_fk
FOREIGN KEY (location_id)
REFERENCES LOCATIONS(location_id);

ALTER TABLE EMPLOYEES
ADD CONSTRAINT emp_job_fk
FOREIGN KEY (job_id)
REFERENCES JOBS(job_id);

ALTER TABLE EMPLOYEES
ADD CONSTRAINT emp_dept_fk
FOREIGN KEY (department_id)
REFERENCES DEPARTMENTS(department_id);

ALTER TABLE EMPLOYEES
ADD CONSTRAINT emp_manager_fk
FOREIGN KEY (manager_id)
REFERENCES EMPLOYEES(employee_id);

ALTER TABLE JOB_HISTORY
ADD CONSTRAINT jh_emp_fk
FOREIGN KEY (employee_id)
REFERENCES EMPLOYEES(employee_id);

ALTER TABLE JOB_HISTORY
ADD CONSTRAINT jh_job_fk
FOREIGN KEY (job_id)
REFERENCES JOBS(job_id);

ALTER TABLE JOB_HISTORY
ADD CONSTRAINT jh_dept_fk
FOREIGN KEY (department_id)
REFERENCES DEPARTMENTS(department_id);


DROP TABLE JOB_HISTORY;

SELECT object_name, original_name, type
FROM recyclebin
WHERE original_name = 'JOB_HISTORY';

FLASHBACK TABLE "BIN$1gMo3FjMRBW0woBFnn/9lg==$0" TO BEFORE DROP;

SELECT table_name
FROM user_tables
WHERE table_name = 'JOB_HISTORY';

